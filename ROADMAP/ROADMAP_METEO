Roadmap : Module M√©t√©o & Alertes (Operational Safety)
Ce document d√©taille l'int√©gration des donn√©es m√©t√©orologiques en temps r√©el (OpenWeatherMap) dans l'interface d'administration.

Objectif Business : S√©curiser les sorties (alertes vent/orage) et anticiper l'affluence ou les annulations.

‚öôÔ∏è Phase 1 : Infrastructure & API Externe
Objectif : Connecter l'application √† un fournisseur de donn√©es fiable sans exposer les cl√©s API.

1. Choix du Fournisseur
Utilisation de OpenWeatherMap (One Call API 3.0) qui fournit :

M√©t√©o actuelle.

Pr√©visions horaires (48h) pour anticiper les grains.

Vitesse du vent et rafales (Critique pour les barques).

2. Configuration des Variables
Fichier : .env (et .env.local)

Variables √† ajouter :

Bash

# WEATHER (OpenWeatherMap)
WEATHER_API_KEY="votre_cle_api_ici"
# Coordonn√©es de la base nautique (Ex: Base Sweet Narcisse)
WEATHER_LAT="48.5839" 
WEATHER_LON="7.7455"
# Seuil d'alerte vent (km/h) pour affichage rouge
NEXT_PUBLIC_WIND_ALERT_THRESHOLD="25"
üèóÔ∏è Phase 2 : Backend (Proxy & Cache)
Objectif : Cr√©er une route API interne pour servir les donn√©es au front tout en g√©rant le cache (limiter les co√ªts/appels).

1. Service M√©t√©o (Server-Side)
Fichier : lib/weather.ts (Nouveau)

Logique :

Fonction getWeatherForecast().

Utilisation de fetch avec next: { revalidate: 900 } (Cache de 15 min).

Conversion des unit√©s si n√©cessaire (m/s vers km/h pour le vent).

TypeScript

// Exemple simplifi√©
export async function getWeatherForecast() {
  const apiKey = process.env.WEATHER_API_KEY
  const lat = process.env.WEATHER_LAT
  const lon = process.env.WEATHER_LON
  
  const url = `https://api.openweathermap.org/data/3.0/onecall?lat=${lat}&lon=${lon}&exclude=minutely&units=metric&lang=fr&appid=${apiKey}`
  
  const res = await fetch(url, { next: { revalidate: 900 } }) // Cache 15 min
  if (!res.ok) throw new Error('Weather fetch failed')
  return res.json()
}
2. Route API
Fichier : app/api/admin/weather/route.ts (Nouveau)

R√¥le : Exposer les donn√©es nettoy√©es au front-end (Admin seulement).

S√©curit√© : V√©rifier que l'utilisateur est bien un membre du staff (via auth()).

üñ•Ô∏è Phase 3 : Composants UI (Le Widget)
Objectif : Un affichage compact mais riche en informations d√©cisionnelles.

1. Composant WeatherWidget
Fichier : app/admin/_components/WeatherWidget.tsx (Nouveau)

Design (Cartes) :

Gauche (Actuel) : Ic√¥ne √©norme (Soleil/Nuage), Temp√©rature, Vent (avec code couleur).

Droite (Timeline) : Pr√©visions h+1, h+2, h+3 (Pluie/Vent).

Logique d'Alerte :

Si vent > WIND_ALERT_THRESHOLD (ex: 25 km/h) ‚Üí Fond rouge clignotant ou banni√®re "NAVIGATION DANGEREUSE".

Si pluie pr√©vue dans < 1h ‚Üí Badge "Pluie imminente".

2. Int√©gration des Ic√¥nes
Utiliser la librairie lucide-react d√©j√† install√©e (Wind, CloudRain, Sun, CloudLightning).

üöÄ Phase 4 : Int√©gration Dashboard
Objectif : Rendre l'information visible d√®s la connexion.

1. Ajout au Dashboard "Aujourd'hui"
Fichier : app/admin/today/page.tsx

Action : Ins√©rer le <WeatherWidget /> tout en haut de la page, au-dessus de la liste des d√©parts.

Pourquoi ? C'est la premi√®re chose que le staff doit voir en ouvrant la caisse pour savoir s'ils peuvent louer.

2. (Bonus) Indicateur dans la Navigation
Fichier : app/admin/_components/AdminPageShell.tsx

Id√©e : Ajouter une petite pastille m√©t√©o (ex: "‚òÄÔ∏è 24¬∞C") dans la TopBar √† c√¥t√© du profil utilisateur, visible sur toutes les pages admin.

‚úÖ Checklist de Validation
[ ] Compte API : Cl√© OpenWeatherMap active et "One Call 3.0" souscrit (1000 appels/jour gratuits).

[ ] Env : Coordonn√©es GPS pr√©cises de la base ajout√©es au .env.

[ ] Cache : V√©rifier que les appels ne se font pas √† chaque rafra√Æchissement de page (via logs serveur).

[ ] S√©curit√© : Le widget affiche une alerte visuelle claire si le vent d√©passe 25 km/h.

[ ] Unit√©s : Le vent est bien affich√© en km/h (plus parlant pour le staff que m/s ou n≈ìuds).