# Sweet Narcisse - Cron Jobs Configuration
# Copy this file to /etc/cron.d/sweet-narcisse or add to crontab
#
# Format: minute hour day month weekday user command

# ============================================================================
# Secret Rotation - Monthly (1st of each month at 3 AM)
# ============================================================================
# Rotates NEXTAUTH_SECRET for security
0 3 1 * * root /opt/sweet-narcisse/scripts/rotate-secrets.sh >> /var/log/sweet-narcisse/cron.log 2>&1

# ============================================================================
# Database Backup - Every 6 hours (0, 6, 12, 18)
# ============================================================================
# Creates compressed PostgreSQL snapshots, uploads to MinIO
0 0,6,12,18 * * * root /opt/sweet-narcisse/scripts/backup-db.sh >> /var/log/sweet-narcisse/cron.log 2>&1

# ============================================================================
# Document Purge - Daily at 4 AM
# ============================================================================
# Cleans up expired/archived employee documents
0 4 * * * root cd /opt/sweet-narcisse && npx tsx scripts/cron/purgeEmployeeDocs.ts >> /var/log/sweet-narcisse/cron.log 2>&1

# ============================================================================
# Audit Log Archive - Daily at 5 AM
# ============================================================================
# Archives and encrypts audit logs to MinIO
0 5 * * * root /opt/sweet-narcisse/scripts/archive-audit-logs.sh >> /var/log/sweet-narcisse/cron.log 2>&1

# ============================================================================
# Log Rotation - Weekly (Sunday at 2 AM)
# ============================================================================
# Archives and compresses old logs
0 2 * * 0 root /opt/sweet-narcisse/scripts/rotate-logs.sh >> /var/log/sweet-narcisse/cron.log 2>&1

# ============================================================================
# Restore Test - Monthly (15th at 4 AM)
# ============================================================================
# Validates backup integrity by restoring to temp database
0 4 15 * * root /opt/sweet-narcisse/scripts/test-restore.sh >> /var/log/sweet-narcisse/cron.log 2>&1

# ============================================================================
# Health Check - Every 5 minutes
# ============================================================================
# Monitors application health and restarts if needed
*/5 * * * * root curl -sf http://localhost:3000/api/health > /dev/null || systemctl restart sweet-narcisse
